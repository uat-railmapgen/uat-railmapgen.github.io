import{j as e,aq as ue,a as pe,ar as Ve,H as y,T as k,B as se,as as E,at as X,F as H,au as te,af as de,a6 as oe,a7 as ie,a9 as Le,aa as F,ab as U,I as Qe,e as V,g as Ze,b as j,av as I,aw as Be,ax as ye,ay as Me,az as et,a4 as ht,aA as Y,Z as xe,aB as Q,$ as Z,a0 as we,a1 as ee,aC as Pe,aD as q,a5 as Re,aE as Fe,a2 as re,aF as Ue,D as Ae,ae as ut,am as pt,aG as Ge,aH as xt,aI as gt,aJ as jt,aK as $e,Q as tt,aL as ve,aM as Se,W as Ie,k as Oe,P as mt,l as ft,m as wt,R as vt,U as St,V as kt,X as bt,aN as Ct,aO as zt,aP as ke,N as yt}from"./chakra-DfZKn_--.js";import{m as w,r as C,n as st,b as z,B as Mt}from"./react-CYUv4v4k.js";import{F as Rt,u as O,a as D,f as je,g as me,S as N,b as $,A as P,s as W,c as He,n as Te,d as fe,e as he,h as De,i as At,j as Ht,l as Tt,k as J,E as B,o as Et,m as Lt,t as Ee,p as Pt,q as It,r as Ot,v as nt,w as be,x as Dt,L as _t,N as Nt,y as at,z as Vt,B as Bt,C as Ft,D as Ut}from"./main-DvfkRiRC.js";import{l as ne,e as T,f as R,r as f,b as ot,i as Gt,u as $t,j as Wt,g as Ce,h as Jt}from"./index-CJIIdY0f.js";import{R as it}from"./rmg-fields-Do-CSbtP.js";var Kt=["en","zh-Hans","zh-Hant"],qt=["ja","ko"],We={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ja:"英語",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},kk:{en:"Kazakh",kk:"Қазақша",ko:"카자흐어","zh-Hans":"哈萨克文","zh-Hant":"哈薩克文"},ko:{en:"Korean",ja:"韓国語",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},uk:{en:"Ukrainian",ko:"우크라이나어",uk:"Українська","zh-Hans":"乌克兰文","zh-Hant":"烏克蘭文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},"zh-Hans":{en:"Simplified Chinese",ja:"中国語（簡体字）",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ja:"中国語（繁体字）",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"}};const Xt="/assets/rmp-logo512-eHekupnf.png",Yt={flex:1,justifyContent:"center",mb:10,"& > div":{mb:3},"& img":{w:120,p:2,backgroundColor:"white",borderRadius:12}};function Qt(){const{t}=w();return e.jsxs(ue,{sx:Yt,children:[e.jsxs(pe,{spacing:3,children:[e.jsx(Ve,{src:"/logo512.png"}),e.jsx(Ve,{src:Xt,backgroundColor:"white"})]}),e.jsx(y,{children:t("Welcome to Rail Map Toolkit")}),e.jsx(k,{fontSize:"lg",textAlign:"center",children:t("Select an app to start your own rail map design!")})]})}function Zt(t){const{tab:s,isActive:n}=t,a=C.useMemo(()=>{var o;return(o=s.url)!=null?o:"/"+s.app+"/"},[s.url,s.app]);return e.jsx(se,{display:n?"block":"none",flex:1,children:e.jsx("iframe",{id:Rt+s.id,src:a,loading:"lazy",title:s.app,width:"100%",height:"100%"})})}function es(){const{openedTabs:t,activeTab:s}=O(a=>a.app),[,n]=st();return C.useEffect(()=>{var a;if(s){const o=(a=t.find(r=>r.id===s))==null?void 0:a.app;n(o?{app:o}:{})}else n({})},[s]),t.length===0?e.jsx(Qt,{}):e.jsx(e.Fragment,{children:t.map(a=>e.jsx(Zt,{tab:a,isActive:s===a.id},a.id))})}function ts(t){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"},child:[]}]})(t)}function ss(t){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M11 7h2v2h-2V7zm0 4h2v6h-2v-6zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"},child:[]}]})(t)}function ae(t){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"},child:[]}]})(t)}function ns(t){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"},child:[]}]})(t)}function as(t){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},child:[]}]})(t)}function os(t){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.49 2 2 6.49 2 12s4.49 10 10 10 10-4.49 10-10S17.51 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3-8c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3z"},child:[]}]})(t)}function is(t){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"},child:[]}]})(t)}function rs(t){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"},child:[]}]})(t)}function Je(t){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(t)}function cs(t){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"},child:[]}]})(t)}function ls(t){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"},child:[]}]})(t)}function ds(t){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"},child:[]}]})(t)}const hs=()=>{const t=X(),{t:s}=w(),n=D(),{isLoggedIn:a,name:o,token:r,refreshToken:i,saves:d,currentSaveId:c}=O(u=>u.account),h=u=>t({title:u,status:"error",duration:9e3,isClosable:!0});z.useEffect(()=>{a&&n(je())},[a]),z.useEffect(()=>{c&&p()},[c]);const p=async()=>{var m;const u=await me(N.RMP);if(!u){v();return}const{hash:x}=u,b=(m=d.filter(S=>S.id===c).at(0))==null?void 0:m.hash;b&&b!==x&&v()},v=async()=>{const{rep:u,token:x,refreshToken:b}=await $(P.SAVES+"/"+c,{},r,i);if(!b||!x){h(s("Login status expired"));return}if(n(W({access:x,refresh:b})),u.status!==200){h(await u.text());return}ne.info("Set ".concat(N.RMP," with save id: ").concat(c)),He(N.RMP,await u.text()),Te()};return e.jsxs(H,{p:"1",flexDirection:"row",children:[e.jsx(te,{name:a?o:void 0}),e.jsx(se,{ml:"3",alignContent:"center",children:e.jsx(k,{as:"b",children:a?o:s("Log in / Sign up")})}),e.jsx(se,{ml:"auto",alignContent:"center",children:e.jsx(de,{"aria-label":"More account info",variant:"ghost",size:"md",onClick:()=>n(fe("account")),icon:e.jsx(is,{})})})]})},us=hs,ps=t=>{const s=X(),{t:n}=w(),a=D(),[o,r]=z.useState(""),[i,d]=z.useState(""),[c,h]=z.useState(""),[p,v]=z.useState(""),u=m=>s({title:m,status:"error",duration:9e3,isClosable:!0}),x=async()=>{const m=await fetch(he+P.AUTH_SEND_RESET_PASSWORD_EMAIL,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:o})});if(m.status===204){v(o);return}if(m.status===400){v("error");return}},b=async()=>{const m=new URLSearchParams({token:c}),S="".concat(he).concat(P.AUTH_RESET_PASSWORD,"?").concat(m.toString()),l=await fetch(S,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:i})});if(l.status!==204){u(await l.text());return}const{error:L,username:G}=(await a(De({email:o,password:i}))).payload;s(L?{title:L,status:"error",duration:9e3,isClosable:!0}:{title:n("Welcome ")+G,status:"success",duration:5e3,isClosable:!0})};return e.jsxs(T,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:n("Forgot password")})}),p&&e.jsxs(oe,{status:p==="error"?"error":"info",children:[e.jsx(ie,{}),e.jsx(Le,{children:p==="error"?n("Check your email again!"):n("Email with reset link is sent to: ")+p})]}),e.jsxs(H,{p:"3",flexDirection:"column",children:[e.jsxs(F,{children:[e.jsx(U,{children:n("Email")}),e.jsxs(Qe,{size:"md",children:[e.jsx(V,{type:"email",value:o,onChange:m=>r(m.target.value)}),e.jsx(Ze,{width:"4.5rem",children:e.jsx(j,{h:"1.75rem",size:"sm",onClick:x,children:n("Send reset link")})})]})]}),e.jsxs(F,{children:[e.jsx(U,{children:n("Reset password token")}),e.jsx(V,{value:c,onChange:m=>h(m.target.value)})]}),e.jsxs(F,{children:[e.jsx(U,{children:n("Password")}),e.jsx(V,{type:"password",value:i,onChange:m=>d(m.target.value)})]}),e.jsxs(I,{mt:"10",children:[e.jsx(j,{onClick:b,children:n("Reset password")}),e.jsx(j,{onClick:()=>t.setLoginState("login"),children:n("Back to log in")})]})]})]})},xs=t=>{const s=X(),{t:n}=w(),a=D(),[o,r]=z.useState(""),[i,d]=z.useState(""),c=async()=>{const{error:h,username:p}=(await a(De({email:o,password:i}))).payload;s(h?{title:h,status:"error",duration:9e3,isClosable:!0}:{title:n("Welcome ")+p,status:"success",duration:5e3,isClosable:!0})};return e.jsxs(T,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:n("Log in")})}),e.jsxs(H,{p:"3",flexDirection:"column",children:[e.jsxs(F,{children:[e.jsx(U,{children:n("Email")}),e.jsx(V,{type:"email",value:o,onChange:h=>r(h.target.value)})]}),e.jsxs(F,{children:[e.jsx(U,{children:n("Password")}),e.jsx(V,{type:"password",value:i,onChange:h=>d(h.target.value)})]}),e.jsxs(I,{mt:"10",children:[e.jsx(j,{onClick:c,children:n("Log in")}),e.jsx(j,{onClick:()=>t.setLoginState("register"),children:n("Sign up")}),e.jsx(j,{onClick:()=>t.setLoginState("forgot-password"),children:n("Forgot password")})]})]})]})},gs=t=>{const s=X(),{t:n}=w(),a=D(),[o,r]=z.useState(""),[i,d]=z.useState(""),[c,h]=z.useState(""),[p,v]=z.useState(""),[u,x]=z.useState(""),b=l=>s({title:l,status:"error",duration:9e3,isClosable:!0}),m=async()=>{const l=await fetch(he+P.AUTH_SEND_VERIFICATION_EMAIL,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:i})});if(l.status===204){x(i);return}if(l.status===400){x("error");return}},S=async()=>{const l=await fetch(he+P.AUTH_REGISTER,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:o,email:i,password:c,emailVerificationToken:Number(p)})});if(l.status!==201){b(await l.text());return}const{error:L,username:G}=(await a(De({email:i,password:c}))).payload;s(L?{title:L,status:"error",duration:9e3,isClosable:!0}:{title:n("Welcome ")+G,status:"success",duration:5e3,isClosable:!0})};return e.jsxs(T,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:n("Sign up")})}),u&&e.jsxs(oe,{status:u==="error"?"error":"info",children:[e.jsx(ie,{}),e.jsx(Le,{children:u==="error"?n("The email is not valid!"):n("Verification email is sent to: ")+u})]}),e.jsxs(H,{p:"3",flexDirection:"column",children:[e.jsxs(I,{spacing:"25px",children:[e.jsxs(F,{children:[e.jsx(U,{children:n("Name")}),e.jsx(V,{type:"text",value:o,onChange:l=>r(l.target.value)}),e.jsx(Be,{children:n("You may always change it later.")})]}),e.jsxs(F,{children:[e.jsx(U,{children:n("Email")}),e.jsxs(Qe,{size:"md",children:[e.jsx(V,{type:"email",value:i,onChange:l=>d(l.target.value)}),e.jsx(Ze,{width:"auto",children:e.jsx(j,{h:"1.75rem",size:"sm",onClick:m,children:n("Send verification code")})})]}),e.jsx(Be,{children:n("We'll never share your email.")})]}),e.jsxs(F,{children:[e.jsx(U,{children:n("Verification code")}),e.jsx(V,{type:"number",value:p,onChange:l=>v(l.target.value)})]}),e.jsxs(F,{children:[e.jsx(U,{children:n("Password")}),e.jsx(V,{type:"password",value:c,onChange:l=>h(l.target.value)})]})]}),e.jsxs(I,{mt:"10",children:[e.jsx(j,{onClick:S,children:n("Sign up")}),e.jsx(j,{onClick:()=>t.setLoginState("login"),children:n("Back to log in")})]})]})]})},js=1,ms=10,fs=()=>{const t=X(),{t:s}=w(),n=D(),{isLoggedIn:a,token:o,refreshToken:r,activeSubscriptions:i,currentSaveId:d,saves:c}=O(g=>g.account),h=a&&c&&(i.RMP_CLOUD?c.length<ms:c.length<js),p=Math.min(...(c!=null?c:[]).map(g=>g.id)),v=g=>!i.RMP_CLOUD&&g!==p,[u,x]=z.useState(void 0),[b,m]=z.useState(void 0),S=g=>t({title:g,status:"error",duration:9e3,isClosable:!0}),l=async()=>{const g=await me(N.RMP);if(!a||!g||!o){S(s("Failed to get the RMP save!"));return}const{data:M,hash:A}=g,_=crypto.randomUUID(),{rep:K,token:ce,refreshToken:le}=await $(P.SAVES,{method:"POST",body:JSON.stringify({index:_,data:M,hash:A})},o,r);if(!le||!ce){S(s("Login status expired"));return}if(n(W({access:ce,refresh:le})),K.status!==200){S(await K.text());return}n(je())},L=async g=>{if(!(!a||!o)){if(g===d){if(x(d),!d||v(d)){S(s("Can not sync this save!")),x(void 0);return}const M=await me(N.RMP);if(!M){S(s("Failed to get the RMP save!")),x(void 0);return}const{data:A,hash:_}=M,{rep:K,token:ce,refreshToken:le}=await $(P.SAVES+"/"+d,{method:"PATCH",body:JSON.stringify({data:A,hash:_})},o,r);if(!le||!ce){S(s("Login status expired")),x(void 0);return}if(n(W({access:ce,refresh:le})),K.status!==200){S(await K.text()),x(void 0);return}x(void 0)}else{x(g);const{rep:M,token:A,refreshToken:_}=await $(P.SAVES+"/"+g,{},o,r);if(!_||!A){S(s("Login status expired")),x(void 0);return}if(n(W({access:A,refresh:_})),M.status!==200){S(await M.text()),x(void 0);return}ne.info("Set ".concat(N.RMP," with save id: ").concat(g)),He(N.RMP,await M.text()),Te(),x(void 0)}n(je())}},G=async g=>{if(!a||!g||!o)return;m(g);const{rep:M,token:A,refreshToken:_}=await $(P.SAVES+"/"+d,{method:"DELETE"},o,r);if(!_||!A){S(s("Login status expired")),m(void 0);return}if(n(W({access:A,refresh:_})),M.status!==200){S(await M.text()),m(void 0);return}n(je()),m(void 0)};z.useEffect(()=>{d&&ge()},[d]);const ge=async()=>{var _;const g=await me(N.RMP);if(!g){Ne();return}const{hash:M}=g,A=(_=c.filter(K=>K.id===d).at(0))==null?void 0:_.hash;A&&A!==M&&Ne()},Ne=async()=>{const{rep:g,token:M,refreshToken:A}=await $(P.SAVES+"/"+d,{},o,r);if(!A||!M){S(s("Login status expired"));return}if(n(W({access:M,refresh:A})),g.status!==200){S(await g.text());return}ne.info("Set ".concat(N.RMP," with save id: ").concat(d)),He(N.RMP,await g.text()),Te()};return e.jsxs(T,{children:[e.jsx(R,{children:e.jsxs(pe,{width:"100%",children:[e.jsx(y,{as:"h4",size:"md",my:1,children:s("Synced saves")}),e.jsxs(k,{ml:"auto",children:[s("Maximum save count:")," ",i.RMP_CLOUD?10:1]}),e.jsx(j,{size:"sm",isDisabled:!h,onClick:l,children:s("Create")})]})}),e.jsx(I,{mt:"2",children:c&&c.map(g=>e.jsx(ye,{overflow:"hidden",variant:"outline",mb:"3",children:e.jsxs(I,{direction:{base:"column",sm:"row"},children:[e.jsxs(Me,{children:[e.jsx(k,{py:"2",as:"b",children:g.id===d?s("Current save"):s("Cloud save")}),e.jsxs(k,{py:"2",children:[s("Last update at:")," ",new Date(g.lastUpdateAt).toLocaleString()]})]}),e.jsx(et,{children:e.jsxs(I,{children:[e.jsx(j,{variant:"solid",colorScheme:"red",isLoading:b===g.id,onClick:()=>G(g.id),children:s("Delete this save")}),e.jsx(j,{variant:"solid",colorScheme:"blue",isDisabled:v(g.id),isLoading:u===g.id,onClick:()=>L(g.id),children:g.id===d?s("Sync now"):s("Sync this slot")})]})})]})},g.id))})]})},ws=t=>{const s=X(),{t:n}=w(),{isOpen:a,onClose:o,getSubscriptions:r}=t,{isLoggedIn:i,token:d,refreshToken:c}=O(b=>b.account),h=D(),p=ht("primary.500","primary.300"),[v,u]=z.useState(""),x=async()=>{if(!i)return;const{rep:b,token:m,refreshToken:S}=await $(P.SUBSCRIPTION_REDEEM,{method:"POST",body:JSON.stringify({cdkey:v})},d,c);if(!(!S||!m)){if(h(W({access:m,refresh:S})),b.status!==202){const l=(await b.json()).message;s({title:n(l),status:"error",duration:5e3,isClosable:!0});return}await r(),o()}};return e.jsxs(Y,{isOpen:a,onClose:o,size:"xl",scrollBehavior:"inside",children:[e.jsx(xe,{}),e.jsxs(Q,{children:[e.jsx(Z,{children:n("Redeem your subscription")}),e.jsx(we,{}),e.jsxs(ee,{children:[e.jsx(k,{children:n("CDKey could be purchased in the following sites:")}),e.jsxs(Pe,{children:[e.jsx(q,{children:e.jsxs(Re,{color:p,href:"https://afdian.com/a/rail-map-toolkit",isExternal:!0,children:["爱发电 ",e.jsx(Fe,{as:ae})]})}),e.jsx(q,{children:e.jsxs(Re,{color:p,href:"https://opencollective.com/rail-map-toolkit",isExternal:!0,children:["OpenCollective ",e.jsx(Fe,{as:ae})]})})]}),e.jsxs(I,{mt:"5",direction:{base:"column",sm:"row"},children:[e.jsx(k,{children:n("Enter your CDKey here:")}),e.jsx(V,{w:"auto",value:v,onChange:b=>u(b.target.value)}),e.jsx(j,{colorScheme:"teal",onClick:x,children:n("Redeem")})]})]}),e.jsx(re,{})]})]})},vs=()=>{const t=X(),{t:s}=w(),{isLoggedIn:n,token:a,refreshToken:o}=O(u=>u.account),r=D(),[i,d]=z.useState([]),[c,h]=z.useState(!1),p=u=>t({title:u,status:"error",duration:9e3,isClosable:!0}),v=async()=>{if(!n)return;const{rep:u,token:x,refreshToken:b}=await $(P.SUBSCRIPTION,{},a,o);if(!b||!x){p(s("Login status expired"));return}if(r(W({access:x,refresh:b})),u.status!==200){p(await u.text());return}const m=(await u.json()).subscriptions;if(!m.map(l=>l.type).includes("RMP_CLOUD"))return;d([{type:"RMP",expires:m[0].expires}]);const S=structuredClone(At);for(const l of m){const L=l.type;L in S&&(S[L]=!0)}r(Ht(S))};return z.useEffect(()=>{v()},[]),e.jsxs(T,{children:[e.jsx(R,{children:e.jsxs(pe,{width:"100%",children:[e.jsx(y,{as:"h4",size:"md",my:1,children:s("All subscriptions")}),e.jsx(j,{size:"sm",ml:"auto",onClick:()=>h(!0),children:s("Redeem")})]})}),e.jsxs(I,{mt:"2",children:[i.length>0&&e.jsxs(ye,{overflow:"hidden",variant:"outline",mb:"3",children:[e.jsx(Ue,{children:e.jsx(y,{size:"md",children:s("Rail Map Painter")})}),e.jsx(I,{direction:{base:"column",sm:"row"},children:e.jsx(Me,{children:e.jsxs(I,{children:[e.jsx(k,{children:s("With this subscription, the following features are unlocked:")}),e.jsxs(Pe,{children:[e.jsx(q,{children:e.jsx(k,{children:s("PRO features")})}),e.jsx(q,{children:e.jsx(k,{children:s("Sync 9 more saves")})}),e.jsx(q,{children:e.jsx(k,{children:s("Unlimited master nodes")})}),e.jsx(q,{children:e.jsx(k,{children:s("Unlimited parallel lines")})})]}),e.jsxs(k,{children:[s("Expires at:")," ",s("Not applicable")]})]})})})]}),i.map(u=>e.jsxs(ye,{overflow:"hidden",variant:"outline",mb:"3",children:[e.jsx(Ue,{children:e.jsx(y,{size:"md",children:s(u.type==="RMP"?"Rail Map Painter":u.type)})}),e.jsxs(I,{direction:{base:"column",sm:"row"},children:[e.jsx(Me,{children:e.jsxs(k,{py:"2",children:[s("Expires at:")," ",new Date(u.expires).toLocaleString()]})}),e.jsx(et,{children:e.jsx(j,{variant:"solid",colorScheme:"blue",children:s("Renew")})})]})]},u.type))]}),e.jsx(ws,{isOpen:c,onClose:()=>h(!1),getSubscriptions:v})]})},Ss=()=>{const{t}=w(),s=D(),{isLoggedIn:n,name:a,refreshToken:o}=O(c=>c.account),[r,i]=z.useState("login"),d=async()=>{n&&(await fetch(he+P.AUTH_LOGOUT,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({refreshToken:o})}),s(Tt()))};return e.jsxs(T,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:t("Account")})}),n?e.jsx(H,{flexDirection:"column",alignItems:"center",children:e.jsxs(I,{width:"100%",p:"2",spacing:"30px",children:[e.jsx(R,{width:"100%",children:e.jsxs(pe,{width:"100%",children:[e.jsx(te,{size:"md",name:a}),e.jsx(k,{as:"b",fontSize:"xl",children:a}),e.jsx(j,{size:"sm",ml:"auto",onClick:d,children:t("Log out")})]})}),e.jsx(Ae,{}),e.jsx(vs,{}),e.jsx(Ae,{}),e.jsx(fs,{})]})}):r==="login"?e.jsx(xs,{setLoginState:i}):r==="register"?e.jsx(gs,{setLoginState:i}):e.jsx(ps,{setLoginState:i})]})},ks=Ss,Ke={"& button:first-of-type":{w:"100%",overflow:"hidden",justifyContent:"flex-start",textOverflow:"ellipsis",textAlign:"start","& span.chakra-button__icon":{ml:-1,color:"orange.300",'[data-theme="dark"] &':{color:"orange.200"}}},'&[aria-current="true"] > button':{bg:"primary.50",_hover:{bg:"primary.100"},'[data-theme="dark"] &':{bg:"primary.700",_hover:{bg:"primary.600"}}},"& > div":{zIndex:6}};function bs(t){var S;const{appId:s,onAboutOpen:n}=t,{t:a}=w(),o=D(),r=ut("(min-width: ".concat(pt.breakpoints.sm,")")),{activeTab:i,openedTabs:d}=O(l=>l.app),c=J[s],h=c.name.split(" - ").map(l=>a(l)).join(" - "),p=d.some(l=>l.app===s),v=!c.allowMultiInstances&&((S=d.find(l=>l.id===i))==null?void 0:S.app)===s,u=l=>{p||f.event(B.OPEN_APP,{appId:s,isOpenInNew:l}),o(l?Et(s):Lt({appId:s})),r[0]||(o(Ee()),f.toggleNavMenu(!1))},x=l=>{o(Pt(l)),r[0]||(o(Ee()),f.toggleNavMenu(!1))},b=l=>{o(It(l)),f.event(B.CLOSE_APP,{app:s})},m=l=>{o(Ot(l)),f.event(B.CLOSE_APP,{app:l})};return e.jsxs(e.Fragment,{children:[e.jsxs(Ge,{variant:v?"solid":"ghost",size:"md",isAttached:!0,"aria-current":v,sx:Ke,children:[e.jsx(j,{onClick:()=>u(!1),leftIcon:p?e.jsx(os,{title:a("Running")}):e.jsx(se,{w:4}),children:h}),c.allowMultiInstances&&e.jsx(de,{"aria-label":a("New tab"),title:a("New tab"),icon:e.jsx(as,{}),onClick:()=>u(!0)}),e.jsxs(xt,{children:[e.jsx(gt,{as:de,icon:e.jsx(ls,{}),"aria-label":a("More"),title:a("More")}),e.jsxs(jt,{children:[p&&e.jsx($e,{icon:e.jsx(Je,{}),onClick:()=>m(s),children:c.allowMultiInstances?a("Close all tabs"):a("Close app")}),e.jsx($e,{icon:e.jsx(ss,{}),onClick:n,children:a("About")})]})]})]}),c.allowMultiInstances&&d.filter(l=>l.app===s).map((l,L)=>{var ge;const G=l.id===i;return e.jsxs(Ge,{variant:G?"solid":"ghost",size:"sm",ml:8,mr:1,isAttached:!0,"aria-current":G,sx:Ke,children:[e.jsxs(j,{onClick:()=>x(l.id),children:[e.jsx(tt,{mr:2,children:L+1}),(ge=l.title)!=null?ge:a("Tab")+" "+(L+1).toString()+" - "+h]}),e.jsx(de,{"aria-label":a("Close tab"),title:a("Close tab"),icon:e.jsx(Je,{}),onClick:()=>b(l.id)})]},l.id)})]})}const Cs=async t=>{const s="/".concat(t,"/info.json");try{return(await(await fetch(s)).json()).version}catch(n){return ne.info("Failed to get version of ".concat(t)),"unknown"}},zs=async(t,s)=>{const n="/".concat(t,"/legacy-contributor-list.txt");return(await(await fetch(n,{signal:s})).text()).split("\n")};function ys(t){var d,c,h;const{appId:s,onClose:n}=t,{t:a}=w(),[o,r]=C.useState("Unknown"),i=s?(h=(c=(d=J[s])==null?void 0:d.url)==null?void 0:c.split("/"))==null?void 0:h[1]:void 0;return C.useEffect(()=>{i?Cs(i).then(p=>r(p)):r("Unknown")},[i]),e.jsxs(Y,{isOpen:!!s,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(xe,{}),e.jsxs(Q,{children:[e.jsxs(Z,{children:[a("About")+" "+(s?J[s].name.split(" - ").map(p=>a(p)).join(" - "):""),e.jsx(tt,{ml:1,children:o})]}),e.jsx(we,{}),e.jsx(ee,{}),e.jsx(re,{children:e.jsx(j,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/"+i,"_blank"),children:a("Visit GitHub")})})]})]})}function qe({assetType:t}){const{t:s}=w(),[n,a]=C.useState(),o=nt(t,f.getEnv(),f.getInstance());return e.jsxs(T,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:s(t==="devtool"?"Devtools":"Apps")})}),e.jsx(H,{direction:"column",children:o.map(r=>e.jsx(bs,{appId:r,onAboutOpen:()=>a(r)},r))}),e.jsx(ys,{appId:n,onClose:()=>a(void 0)})]})}const Ms={"& button":{w:"100%",overflow:"hidden",justifyContent:"flex-start",textOverflow:"ellipsis",textAlign:"start","& span.chakra-button__icon:last-of-type":{ml:"auto"}}};function Rs(){const{t}=w(),s=nt("link",f.getEnv(),f.getInstance()),n=a=>{f.event(B.OPEN_LINK,{id:a}),window.open(J[a].url,"_blank")};return e.jsxs(T,{sx:Ms,children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:t("Useful links")})}),e.jsx(H,{direction:"column",children:s.map(a=>e.jsx(j,{variant:"ghost",size:"md",leftIcon:e.jsx(se,{w:4}),rightIcon:e.jsx(ae,{}),onClick:()=>n(a),children:t(J[a].name)},a))})]})}const As={"& > span":{minW:"75%",borderRadius:"lg",cursor:"pointer","& > span:last-of-type":{display:"block"},"& p":{fontSize:"sm","&:first-of-type":{fontSize:"lg",fontWeight:"bold",mb:1}}},"& .chakra-avatar":{ml:1,mr:3,my:4}};function Hs(){const{t}=w();return e.jsxs(T,{children:[e.jsx(R,{children:e.jsx(y,{as:"h5",size:"sm",children:t("Developer team")})}),e.jsxs(ue,{sx:As,children:[e.jsxs(ve,{size:"lg",onClick:()=>window.open("https://github.com/wongchito","_blank"),children:[e.jsx(te,{src:"https://github.com/wongchito.png",size:"lg"}),e.jsxs(Se,{children:[e.jsx(k,{children:"Chito Wong"}),e.jsx(k,{children:"Author of Rail Map Toolkit platform"}),e.jsx(k,{children:"Author of Rail Map Generator"})]})]}),e.jsxs(ve,{size:"lg",onClick:()=>window.open("https://github.com/thekingofcity","_blank"),children:[e.jsx(te,{src:"https://github.com/thekingofcity.png",size:"lg"}),e.jsxs(Se,{children:[e.jsx(k,{children:"thekingofcity"}),e.jsx(k,{children:"Author of Rail Map Painter"}),e.jsx(k,{children:"Author of RMG (Shanghai Metro style)"})]})]}),e.jsxs(ve,{size:"lg",onClick:()=>window.open("https://github.com/langonginc","_blank"),children:[e.jsx(te,{src:"https://github.com/langonginc.png",size:"lg"}),e.jsxs(Se,{children:[e.jsx(k,{children:"langonginc"}),e.jsx(k,{children:"Author of Rail Map Painter"})]})]})]})]})}function _e(t){const{login:s,urlRepo:n,...a}=t,o=n?"https://github.com/railmapgen/".concat(n,"/issues?q=is:issue+author:").concat(s):"https://github.com/".concat(s);return e.jsx(te,{name:s,title:s,src:"https://github.com/".concat(s,".png"),loading:"lazy",onClick:()=>window.open(o,"_blank"),cursor:"pointer",...a})}const Ts=["Swiftiecott","linchen1965","28yfang","Windows-Taskmgr"];function Es(){const{t}=w();return e.jsxs(T,{children:[e.jsx(R,{children:e.jsx(y,{as:"h5",size:"sm",children:t("Resource administrators")})}),e.jsx(Ie,{spacing:1.5,px:2,children:Ts.map(s=>e.jsx(Oe,{children:e.jsx(_e,{login:s,size:"md"})},s))})]})}const rt="https://api.github.com/repos/railmapgen",ze={},ct=async(t,s)=>{if(t in ze)return ze[t];const a=await(await fetch(t,s)).json();return ze[t]=a,a},Ls=async(t,s,n)=>{const a="".concat(rt,"/").concat(t,"/contributors"),o=new URLSearchParams({per_page:"100",page:s.toString()});return(await ct(a+"?"+o.toString(),{signal:n})).map(i=>i.login)},Ps=async(t,s,n)=>{const a="".concat(rt,"/").concat(t,"/issues"),o=new URLSearchParams({state:"closed",labels:"donation",per_page:"100",page:s.toString()});return(await ct(a+"?"+o.toString(),{signal:n})).filter(i=>i.state_reason==="completed").map(i=>{var d;return(d=i.user)==null?void 0:d.login})};function lt(t){const[s,n]=C.useState([]);return[s,o=>{n(r=>{const i=new Set(r?r.concat(o):o);return Array.from(i)})}]}const Is=["","wongchito","thekingofcity","github-actions[bot]"],Xe=t=>!Is.includes(t);function Os(t){const[s,n]=lt(),[a,o]=C.useState(!0),[r,i]=C.useState(!1),d=C.useRef(),c=async()=>{var p;let h=0;for(;++h;){d.current=new AbortController;const v=await Ls(t,h,(p=d.current)==null?void 0:p.signal);if(n(v.filter(Xe)),v.length<100)break}};return C.useEffect(()=>(c().then(()=>{var h;return J[t].legacyContributors?(d.current=new AbortController,zs(t,(h=d.current)==null?void 0:h.signal)):[]}).then(h=>n(h.filter(Xe))).catch(h=>{ne.error("unable to fetch contributors for:",t,h),i(!0)}).finally(()=>o(!1)),()=>{var h;(h=d.current)==null||h.abort(),o(!0),i(!1)}),[t]),{contributors:s,isLoading:a,isError:r}}const Ds={position:"relative",minH:20,"& .chakra-alert":{flexDirection:"column"},"& .chakra-alert__icon":{boxSize:7,mr:0,mb:1}};function _s(t){const{appId:s}=t,{t:n}=w(),{contributors:a,isLoading:o,isError:r}=Os(s);return e.jsxs(H,{sx:Ds,children:[o&&e.jsx(ot,{isIndeterminate:!0}),r&&e.jsxs(oe,{status:"warning",children:[e.jsx(ie,{}),n("Unable to load contributors")]}),!r&&a&&e.jsx(Ie,{spacing:1.5,children:a==null?void 0:a.map(i=>e.jsx(Oe,{children:e.jsx(_e,{login:i,urlRepo:s,size:"sm"})},i))})]})}const Ns={"& > *:not(.rmg-section__header)":{px:2},"& h6":{my:2}};function Vs(){const{t}=w();return e.jsxs(T,{sx:Ns,children:[e.jsx(R,{children:e.jsx(y,{as:"h5",size:"sm",children:t("Resource contributors")})}),Object.entries(J).filter(([,s])=>s.showContributors).map(([s,n])=>e.jsxs(C.Fragment,{children:[e.jsx(y,{as:"h6",size:"xs",children:t(n.name)}),e.jsx(_s,{appId:s},s)]},s)),e.jsx(k,{as:"i",fontSize:"xs",mt:3,children:t("Notes: Contributors are sorted by number of commits and commit time.")})]})}function Bs(){const[t,s]=lt(),[n,a]=C.useState(!0),[o,r]=C.useState(!1),i=C.useRef(),d=async()=>{var h;const c=Object.entries(J).filter(([,p])=>p.showDonators).map(([p])=>p);for(const p of c)try{let v=0;for(;++v;){i.current=new AbortController;const u=await Ps(p,v,(h=i.current)==null?void 0:h.signal);if(s(u),u.length<100)break}}catch(v){throw ne.error("unable to fetch donators for:",p,v),v}};return C.useEffect(()=>(d().catch(()=>r(!0)).finally(()=>a(!1)),()=>{var c;(c=i.current)==null||c.abort(),a(!0),r(!1)}),[]),{donators:t,isLoading:n,isError:o}}const Fs={position:"relative",px:2,minH:20,"& .chakra-alert":{flexDirection:"column"},"& .chakra-alert__icon":{boxSize:7,mr:0,mb:1}};function Us(){const{t}=w(),{donators:s,isLoading:n,isError:a}=Bs();return e.jsxs(T,{children:[e.jsx(R,{children:e.jsx(y,{as:"h5",size:"sm",children:"❤️ "+t("Donators")})}),e.jsxs(H,{sx:Fs,children:[n&&e.jsx(ot,{isIndeterminate:!0}),a&&e.jsxs(oe,{status:"warning",children:[e.jsx(ie,{}),t("Unable to load donators")]}),!a&&s&&e.jsx(Ie,{spacing:1.5,children:s==null?void 0:s.map(o=>e.jsx(Oe,{children:e.jsx(_e,{login:o,size:"sm"})},o))})]})]})}const Gs={bg:"inherit",py:0,"& section:not(:last-of-type)":{mb:4}};function $s(t){const{isOpen:s,onClose:n}=t,{t:a}=w();return e.jsxs(Y,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(xe,{}),e.jsxs(Q,{children:[e.jsx(Z,{children:a("Contributors")}),e.jsx(we,{}),e.jsxs(ee,{sx:Gs,children:[e.jsx(Hs,{}),e.jsx(Us,{}),e.jsx(Es,{}),e.jsx(Vs,{})]}),e.jsx(re,{children:e.jsx(j,{colorScheme:"primary",onClick:()=>window.open("https://github.com/railmapgen/rmg/wiki/How-to-add-color-palette-and-line-templates","_blank"),children:a("Contribution Wiki")})})]})]})}function Ws(){const{t}=w(),s=D(),{isShowMenu:n,showFontAdvice:a}=O(i=>i.app),[o,r]=C.useState(n&&a==="show");return C.useEffect(()=>{let i;return n&&a==="show"?i=window.setTimeout(()=>{r(!0)},5e3):r(!1),()=>{window.clearTimeout(i)}},[n,a]),e.jsxs(mt,{isOpen:o,onClose:()=>s(be()),children:[e.jsx(ft,{children:e.jsx(j,{variant:"ghost",size:"sm",w:"100%",leftIcon:e.jsx(ts,{}),onClick:()=>{s(fe("support")),s(be())},children:t("Help & support")})}),e.jsxs(wt,{children:[e.jsx(vt,{}),e.jsx(St,{}),e.jsxs(kt,{children:["💡 ",t("Pro tip")]}),e.jsx(bt,{children:t("Fonts are slow to load? Learn how to speed it up!")}),e.jsxs(Ct,{display:"flex",children:[e.jsx(j,{variant:"ghost",size:"sm",ml:"auto",onClick:()=>{s(Dt()),f.storage.set(_t.SHOW_FONT_ADVICE,Nt)},children:t("Don't show again")}),e.jsx(j,{variant:"solid",colorScheme:"primary",size:"sm",ml:2,onClick:()=>s(be()),children:t("OK")})]})]})]})}function Js(){const{t}=w(),s=D(),{menuView:n,refreshRequired:a}=O(i=>i.app),[o,r]=C.useState(!1);return e.jsxs(H,{direction:"column",children:[e.jsx(Ae,{}),n==="main"?e.jsxs(zt,{templateColumns:"repeat(3, auto)",children:[e.jsx(ke,{children:e.jsx(j,{variant:"ghost",size:"sm",w:"100%",leftIcon:e.jsx(ds,{}),onClick:()=>r(!0),children:t("Contributors")})}),e.jsx(ke,{children:e.jsx(Ws,{})}),e.jsx(ke,{children:e.jsx(j,{variant:"ghost",size:"sm",w:"100%",leftIcon:e.jsx(ns,{}),onClick:()=>s(fe("settings")),children:t("Settings")})})]}):e.jsx(j,{variant:"ghost",size:"sm",w:"100%",leftIcon:e.jsx(rs,{}),onClick:()=>s(fe("main")),isDisabled:a,children:t("Go back")}),e.jsx($s,{isOpen:o,onClose:()=>r(!1)})]})}function dt(){const{t}=w();return{type:"select",label:t("Language"),value:f.getLanguage(),options:{[t("Main languages")]:Kt.reduce((s,n)=>({...s,[n]:We[n][n]}),{}),[t("Other languages")]:qt.reduce((s,n)=>({...s,[n]:We[n][n]}),{})},onChange:s=>{const n=s;f.setLanguage(n),f.getI18nInstance().changeLanguage(n),f.event(B.CHANGE_LANGUAGE,{language:n})}}}function Ks(t){const{isOpen:s,onClose:n}=t,{t:a}=w(),o=Object.entries(localStorage);return e.jsxs(Y,{isOpen:s,onClose:n,size:"xl",scrollBehavior:"inside",children:[e.jsx(xe,{}),e.jsxs(Q,{children:[e.jsx(Z,{children:a("Local Storage")}),e.jsx(we,{}),e.jsx(ee,{children:e.jsx(ue,{p:1,children:o.map(r=>e.jsx(Gt,{label:r[0],minW:"full",children:e.jsx(yt,{value:r[1],readOnly:!0,fontFamily:"monospace",fontSize:"xs"})},r[0]))})}),e.jsx(re,{children:e.jsx(j,{onClick:n,children:a("Go back")})})]})]})}function qs(){const{t}=w(),{setColourMode:s}=$t(),n=D(),{lastShowDevtools:a,refreshRequired:o}=O(x=>x.app),[r,i]=C.useState(f.isAllowAnalytics()),[d,c]=C.useState(!1),h=dt(),p=x=>{i(x),f.allowAnalytics(x).refreshRequired&&n(Ft())},v={light:t("Light"),dark:t("Dark"),system:t("System")},u=[h,{type:"select",label:t("Appearance"),value:f.getColourMode(),options:v,onChange:x=>s(x)},{type:"switch",label:t("Allow cookies to help improve our website"),isChecked:r,onChange:p,oneLine:!0,isDisabled:o},{type:"switch",label:t("Show dev tools for 1 day"),isChecked:at(a),onChange:x=>{x?(n(Vt()),f.event(B.SHOW_DEVTOOLS)):n(Bt())},oneLine:!0}];return e.jsxs(T,{children:[o&&e.jsxs(oe,{status:"info",variant:"solid",size:"xs",children:[e.jsx(ie,{}),t("Refreshing is required for changes to take effect.")]}),e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:t("Settings")})}),e.jsxs(se,{px:2,children:[e.jsx(it,{fields:u,minW:"full"}),e.jsx(j,{width:"100%",onClick:()=>c(!0),children:"Export Local Storage"})]}),e.jsx(Ks,{isOpen:d,onClose:()=>c(!1)})]})}const Xs={px:2,"& button":{w:"100%"}};function Ys(){const{t}=w(),{remoteFonts:s}=O(n=>n.app);return e.jsxs(T,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:t("Web fonts")})}),e.jsxs(ue,{sx:Xs,children:[e.jsxs(k,{as:"i",fontSize:"sm",children:[t("FontsSection.text1")," ",t("FontsSection.text2")," ",t("FontsSection.text3")," (",t("FontsSection.safari"),")"]}),Object.entries(s).map(([n,a])=>e.jsx(j,{size:"sm",rightIcon:a.url?e.jsx(ae,{}):void 0,isDisabled:!a.url,onClick:()=>{window.open(a.url,"_blank"),f.event(B.DOWNLOAD_FONT,{family:n})},children:a.displayName?"".concat(a.displayName," (").concat(n,")"):n},n))]})]})}function Qs(t){return E({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9a17.56 17.56 0 0 0 3.8.4c8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1a102.4 102.4 0 0 1-22.6 2.7c-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1a63 63 0 0 0 25.6-6c2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8a18.64 18.64 0 0 1 5-.5c8.1 0 26.4 3.1 56.6 24.1a208.21 208.21 0 0 1 112.2 0c30.2-21 48.5-24.1 56.6-24.1a18.64 18.64 0 0 1 5 .5c12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5a19.35 19.35 0 0 0 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"},child:[]}]})(t)}function Zs(t){return E({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M126.12 315.1A47.06 47.06 0 1 1 79.06 268h47.06zm23.72 0a47.06 47.06 0 0 1 94.12 0v117.84a47.06 47.06 0 1 1-94.12 0zm47.06-188.98A47.06 47.06 0 1 1 244 79.06v47.06zm0 23.72a47.06 47.06 0 0 1 0 94.12H79.06a47.06 47.06 0 0 1 0-94.12zm188.98 47.06a47.06 47.06 0 1 1 47.06 47.1h-47.06zm-23.72 0a47.06 47.06 0 0 1-94.12 0V79.06a47.06 47.06 0 1 1 94.12 0zM315.1 385.88a47.06 47.06 0 1 1-47.1 47.06v-47.06zm0-23.72a47.06 47.06 0 0 1 0-94.12h117.84a47.06 47.06 0 1 1 0 94.12z"},child:[]}]})(t)}const en={px:2,"& button":{w:"100%"}};function tn(){const{t}=w();return e.jsxs(T,{children:[e.jsx(R,{children:e.jsx(y,{as:"h4",size:"md",my:1,children:t("Help & support")})}),e.jsxs(ue,{sx:en,children:[e.jsx(j,{size:"md",leftIcon:e.jsx(Qs,{}),rightIcon:e.jsx(ae,{}),onClick:()=>{window.open("https://github.com/railmapgen/railmapgen.github.io/issues","_blank"),f.event(B.RAISE_ISSUE)},children:t("Raise an Issue on GitHub")}),e.jsx(j,{size:"md",leftIcon:e.jsx(Zs,{}),rightIcon:e.jsx(ae,{}),onClick:()=>{window.open("https://join.slack.com/t/railmapgenerator/shared_invite/zt-1odhhta3n-DdZF~fnVwo_q0S0RJmgV8A","_blank"),f.event(B.JOIN_SLACK)},children:t("Join us on Slack")})]})]})}const Ye=420,sn={flexShrink:0,flexDirection:"column",overflow:"hidden",alignItems:"flex-end",background:"inherit",transition:"0.3s ease-in-out",maxW:0,visibility:"hidden",boxShadow:"lg",zIndex:100,".show-menu &":{maxW:{base:"100%",md:Ye},w:{base:"100%",md:"unset"},visibility:"initial"},"& > div":{flexDirection:"column",h:"100%",w:{base:"100vw",md:Ye},background:"inherit","& .nav-menu__header":{flex:0,flexDirection:"row",alignItems:"center",minHeight:10,pl:12},"& .nav-menu__body":{flexDirection:"column",flex:1,overflowX:"hidden",overflowY:"auto",background:"inherit"}},"& .chakra-alert":{flexGrow:0,pl:3,pr:2,py:2,"& a":{fontWeight:"bold",textDecoration:"underline","&:hover, &:focus":{textDecoration:"none"}}}};function nn(){const{t}=w(),{menuView:s,lastShowDevtools:n}=O(r=>r.app),[a]=st(),o=(f.getInstance()==="GitLab"?"https://railmapgen.gitlab.io/":"https://railmapgen.github.io/")+"?"+a.toString();return e.jsx(H,{sx:sn,children:e.jsxs(H,{children:[e.jsxs(H,{className:"nav-menu__header",children:[e.jsx(y,{as:"h4",size:"md",children:t("Rail Map Toolkit")}),e.jsx(Wt,{environment:f.getEnv(),version:f.getAppVersion()})]}),f.getEnv()!=="PRD"&&e.jsxs(oe,{status:"warning",children:[e.jsx(ie,{}),e.jsxs(Le,{children:[t("You're currently viewing a testing environment.")," ",e.jsx(Re,{href:o,isExternal:!0,children:t("Back to production environment")})]})]}),e.jsxs(H,{className:"nav-menu__body",children:[s==="main"&&e.jsx(us,{}),s==="main"?e.jsxs(e.Fragment,{children:[e.jsx(qe,{assetType:"app"}),at(n)&&e.jsx(qe,{assetType:"devtool"}),e.jsx(Rs,{})]}):s==="settings"?e.jsx(qs,{}):s==="support"?e.jsxs(e.Fragment,{children:[e.jsx(tn,{}),e.jsx(Ys,{})]}):s==="account"?e.jsx(ks,{}):e.jsx(e.Fragment,{})]}),e.jsx(Js,{})]})})}function an(t){const{isOpen:s,onClose:n}=t,{t:a}=w(),o=C.useRef(null),r=dt(),i=()=>{f.allowAnalytics(!0),n()},d=()=>{f.allowAnalytics(!1).refreshRequired?window.location.reload():n()};return e.jsxs(Y,{initialFocusRef:o,isOpen:s,onClose:()=>{},children:[e.jsx(xe,{}),e.jsxs(Q,{children:[e.jsx(Z,{children:a("CookiesModal.header")}),e.jsxs(ee,{children:[e.jsx(H,{justifyContent:"flex-end",mt:-5,children:e.jsx(it,{fields:[r]})}),e.jsx(k,{children:a("CookiesModal.text1")}),e.jsx(k,{mt:2,children:a("CookiesModal.text2")}),e.jsx(Pe,{children:e.jsxs(q,{children:[" ",a("CookiesModal.item1")]})}),e.jsx(k,{mt:2,children:a("CookiesModal.text3")})]}),e.jsx(re,{children:e.jsxs(pe,{children:[e.jsx(j,{variant:"ghost",onClick:d,children:a("CookiesModal.reject")}),e.jsx(j,{ref:o,colorScheme:"primary",onClick:i,children:a("CookiesModal.accept")})]})})]})]})}const on=()=>{};function rn(){const{t}=w(),[s,n]=C.useState(!1),a=()=>{n(!0),Ut(),setTimeout(()=>{window.location.reload()},1e3)};return e.jsx(Y,{isOpen:!0,onClose:on,children:e.jsxs(Q,{children:[e.jsx(Z,{children:t("Rail Map Toolkit is opened in another window")}),e.jsx(ee,{children:t("You cannot open multiple Rail Map Toolkit at the same time. Please close this window.")}),e.jsx(re,{children:e.jsx(j,{colorScheme:"primary",onClick:a,isLoading:s,children:t("Restart RMT in this window")})})]})})}const cn=()=>{};function ln(){const{t}=w();return e.jsx(Y,{isOpen:!0,onClose:cn,children:e.jsxs(Q,{children:[e.jsx(Z,{children:t("Rail Map Toolkit is opened in another window")}),e.jsx(ee,{children:t("Current session has been terminated. Please close this window.")})]})})}function gn(){const{t}=w(),s=D(),{isPrimary:n,isTerminated:a,isShowMenu:o}=O(c=>c.app),[r,i]=C.useState(!1);C.useEffect(()=>{f.isAnalyticsQADone()||i(!0)},[]);const d=()=>{f.toggleNavMenu(!o),s(Ee()),f.event(B.TOGGLE_NAV_MENU)};return a?e.jsx(Ce,{children:e.jsx(ln,{})}):n===!1?e.jsx(Ce,{children:e.jsx(rn,{})}):e.jsx(Mt,{basename:"/",children:e.jsxs(Ce,{className:o?"show-menu":"",children:[e.jsx(de,{variant:o?"ghost":"solid",colorScheme:o?void 0:"primary",size:"md","aria-label":t("Toggle menu"),title:t("Toggle menu"),icon:e.jsx(cs,{}),position:"absolute",zIndex:110,borderRadius:0,onClick:d}),e.jsxs(Jt,{sx:{flexDirection:"row"},children:[e.jsx(nn,{}),e.jsx(es,{})]}),e.jsx(an,{isOpen:r,onClose:()=>i(!1)})]})})}export{gn as default};
